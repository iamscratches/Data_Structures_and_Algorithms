# üìä Design Spreadsheet - Simple Formula Evaluation System

## üìú Problem Statement
**Link:** [LeetCode Problem](https://leetcode.com/problems/design-spreadsheet/description/?envType=daily-question&envId=2025-09-19)

Design a spreadsheet that supports:
1. **Initialization** with number of rows
2. **Setting** cell values
3. **Resetting** cell values (to default 0)
4. **Getting** cell values, including formula evaluation

**Formula Format:**
- Formulas start with '=' followed by cell1+cell2
- Cells can be alphanumeric references (e.g., "A1") or literal numbers
- Default cell value is 0

**Constraints:**
- 1 ‚â§ rows ‚â§ 100
- 1 ‚â§ formula.length ‚â§ 10
- Formulas are valid and well-formed

**Example:**
```text
Input:
["Spreadsheet", "setCell", "getValue", "setCell", "getValue"]
[[5], ["A1", 10], ["=A1+5"], ["B2", 20], ["=A1+B2"]]

Output: [null, null, 15, null, 30]
```

## üß† Intuition
The solution uses:
1. **HashMap Storage**: Simple key-value store for cell values
2. **Formula Parsing**: Split formula into components and evaluate
3. **Recursive Evaluation**: Handle both cell references and literal numbers
4. **Default Values**: Return 0 for unset cells

Key Insights:
- Formulas are simple additions of two operands
- Operands can be cell references or literal numbers
- The system needs to distinguish between formulas and direct values
- HashMap provides O(1) cell access

## ‚öôÔ∏è Approach
1. **Data Structure**:
   - `HashMap<String, Integer>`: cell name ‚Üí value
2. **Operations**:
   - **setCell**: Store value in HashMap
   - **resetCell**: Remove from HashMap (default to 0)
   - **getValue**: Check if input is formula (starts with '=') or direct cell/value
3. **Formula Evaluation**:
   - Remove '=' prefix
   - Split by '+' into two operands
   - Recursively evaluate each operand

## ‚úÖ Optimized Solution
```java
class Spreadsheet {
    private Map<String, Integer> cellValues;
    private int rows;

    public Spreadsheet(int rows) {
        this.rows = rows;
        this.cellValues = new HashMap<>();
    }
    
    public void setCell(String cell, int value) {
        cellValues.put(cell, value);
    }
    
    public void resetCell(String cell) {
        cellValues.remove(cell);
    }
    
    public int getValue(String input) {
        // Check if input is a formula (starts with '=')
        if (input.startsWith("=")) {
            return evaluateFormula(input.substring(1));
        } else {
            // Direct cell reference or literal number
            return evaluateOperand(input);
        }
    }
    
    private int evaluateFormula(String formula) {
        String[] parts = formula.split("\\+");
        if (parts.length != 2) {
            throw new IllegalArgumentException("Invalid formula format");
        }
        return evaluateOperand(parts[0]) + evaluateOperand(parts[1]);
    }
    
    private int evaluateOperand(String operand) {
        // Check if operand is a literal number
        if (Character.isDigit(operand.charAt(0))) {
            return Integer.parseInt(operand);
        } else {
            // Cell reference
            return cellValues.getOrDefault(operand, 0);
        }
    }
}
```

## ‚è≥ Complexity Analysis
| Operation       | Complexity | Description |
|-----------------|------------|-------------|
| **Constructor** | O(1)       | HashMap initialization |
| **setCell**     | O(1)       | HashMap put |
| **resetCell**   | O(1)       | HashMap remove |
| **getValue**    | O(1)       | Formula parsing and evaluation |

## üìä Example Walkthrough
**Initialization:** rows = 5
- cellValues = {}

**setCell("A1", 10):**
- cellValues = {"A1": 10}

**getValue("=A1+5"):**
- Formula: "A1+5"
- evaluateOperand("A1") ‚Üí 10
- evaluateOperand("5") ‚Üí 5
- Return 10 + 5 = 15

**setCell("B2", 20):**
- cellValues = {"A1": 10, "B2": 20}

**getValue("=A1+B2"):**
- evaluateOperand("A1") ‚Üí 10
- evaluateOperand("B2") ‚Üí 20
- Return 10 + 20 = 30

## üí° Key Features
- **Simple Design**: Easy-to-understand HashMap implementation
- **Formula Support**: Basic arithmetic formula evaluation
- **Error Handling**: Default values for missing cells
- **Efficiency**: Constant time operations for all methods

## üöÄ When to Use
- Simple spreadsheet implementations
- Educational systems for formula evaluation
- When basic cell storage and retrieval is needed
- Prototype systems before full spreadsheet implementation

## ‚ö†Ô∏è Edge Cases
- **Unset cells**: Return default value 0
- **Literal numbers**: Directly parsed as integers
- **Invalid formulas**: Should be handled gracefully
- **Case sensitivity**: Cell names are case-sensitive
- **Non-existent cells**: Handled by default value

## üõ† Variations
1. **Extended Formula Support**:
```java
// Support for subtraction, multiplication, division
```

2. **Cell Dependency Tracking**:
```java
// Graph structure for dependent cell updates
```

3. **Circular Reference Detection**:
```java
// Prevent infinite recursion in formulas
```

4. **Bulk Operations**:
```java
// Set multiple cells at once
```

5. **Visualization**:
```java
// Display spreadsheet grid
```

## System Design Insight
The solution leverages:
- Key-value storage for efficient cell access
- Recursive formula evaluation
- Simple parsing techniques
- Default value pattern for missing data

## Alternative Implementation (2D Array)
```java
class Spreadsheet {
    int[][] cellMap;

    public Spreadsheet(int rows) {
        cellMap = new int[rows+1][26];
    }
    
    public void setCell(String cell, int value) {
        int col = cell.charAt(0)-'A';
        int row = Integer.parseInt(cell.substring(1));
        cellMap[row][col] = value;
    }
    
    public void resetCell(String cell) {
        int col = cell.charAt(0)-'A';
        int row = Integer.parseInt(cell.substring(1));
        cellMap[row][col] = 0;
    }
    
    public int getValue(String formula) {
        formula = formula.substring(1);
        String[] formulaVal = formula.split("\\+");
        int val1=0, val2=0;
        char ch1 = formulaVal[0].charAt(0), ch2=formulaVal[1].charAt(0);
        System.out.println(Arrays.toString(formulaVal));
        if('A'<=ch1 && ch1<='Z'){
            int col = ch1-'A';
            int row = Integer.parseInt(formulaVal[0].substring(1));
            val1 = cellMap[row][col];
        }
        else{
            val1 = Integer.parseInt(formulaVal[0]);
        }
        if('A'<=ch2 && ch2<='Z'){
            int col = ch2-'A';
            int row = Integer.parseInt(formulaVal[1].substring(1));
            val2 = cellMap[row][col];
        }
        else{
            val2 = Integer.parseInt(formulaVal[1]);
        }
        return val1+val2;
    }
}
```
Note: A 2D array implementation would be more memory-efficient for small spreadsheets but less flexible for arbitrary cell references. The HashMap approach is more suitable for the problem constraints.